{"version":3,"sources":["multiply-background-blend-mode-polyfill.js"],"names":["Element","prototype","Document","DocumentFragment","forEach","item","prepend","docFrag","document","createDocumentFragment","Array","slice","call","arguments","argItem","appendChild","Node","createTextNode","String","insertBefore","firstChild","window","NodeList","isNotSupport","getComputedStyle","body","backgroundBlendMode","undefined","createSVGFilter","backgroundImage","backgroundColor","uniqueId","Date","getUTCMilliseconds","filterId","namespaceURI","svg","createElementNS","setAttribute","style","position","top","left","bottom","right","overflow","defs","filter","feImage","setAttributeNS","feBlend","shapeBackground","applyFilter","elements","querySelectorAll","el","borderTopWidth","borderWidth","backgroundImageUrl","replace","dataset","borderTopColor","borderTopStyle","tagName","toLowerCase","running","windowHeight","update","innerHeight","height","documentElement","scrollHeight","requestTick","requestAnimationFrame","addEventListener"],"mappings":"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","file":"multiply-background-blend-mode-polyfill.js","sourcesContent":["// Запускается в браузерах который не поддерживают свойство background-blend-mode.\n// Полифил применяетс к тегам [data-background-blend-mode=\"multiply\"]\n// Изображение и цвет берет с CSS свойств (background-image, background-color)\n// IE 11 работает огранниченное количество фильтров: normal, myltiply, lighten, screen, darken\n//   https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/samples/jj206437(v=vs.85)\n\n// Нужно перекомилировать через Babel\n// Неообходимые полифилы для IE-11\n// Element.prepend\n// NodeList.forEach\n\n// prepend polyfill\n[Element.prototype, Document.prototype, DocumentFragment.prototype].forEach(function (item) {\n  item.prepend = item.prepend || function () {\n    var docFrag = document.createDocumentFragment();\n\n    Array.prototype.slice.call(arguments).forEach(function (argItem) {\n      docFrag.appendChild(argItem instanceof Node ? argItem : document.createTextNode(String(argItem)));\n    });\n\n    this.insertBefore(docFrag, this.firstChild);\n  };\n});\n\nif (window.NodeList && !NodeList.prototype.forEach) {\n  NodeList.prototype.forEach = Array.prototype.forEach;\n}\n\n(() => {\n  const isNotSupport = getComputedStyle(document.body).backgroundBlendMode === undefined;\n\n  // Создаем фильтр\n  const createSVGFilter = ({ backgroundImage, backgroundColor, backgroundBlendMode }) => {\n    const uniqueId = new Date().getUTCMilliseconds();\n    const filterId = `background-filter-${uniqueId}`;\n\n    const namespaceURI = 'http://www.w3.org/2000/svg';\n    const svg = document.createElementNS(namespaceURI, 'svg');\n    svg.setAttribute('height', '100%');\n    svg.setAttribute('width', '100%');\n    svg.style.position = 'absolute';\n    svg.style.top = '0';\n    svg.style.left = '0';\n    svg.style.bottom = '0';\n    svg.style.right = '0';\n    svg.style.overflow = 'hidden';\n\n    const defs = svg.appendChild(document.createElementNS(namespaceURI, 'defs'));\n    const filter = defs.appendChild(document.createElementNS(namespaceURI, 'filter'));\n    filter.setAttribute('id', filterId);\n\n    const feImage = filter.appendChild(document.createElementNS(namespaceURI, 'feImage'));\n    feImage.setAttribute('preserveAspectRatio', 'xMinYMin slice');\n    feImage.setAttribute('x', '0');\n    feImage.setAttribute('y', '0');\n    feImage.setAttribute('height', '100%');\n    feImage.setAttribute('width', '100%');\n    feImage.setAttribute('result', 'slide2');\n    feImage.setAttributeNS('http://www.w3.org/1999/xlink', 'href', backgroundImage);\n\n    const feBlend = filter.appendChild(document.createElementNS(namespaceURI, 'feBlend'));\n    feBlend.setAttribute('preserveAspectRatio', 'xMinYMin slice');\n    feBlend.setAttribute('in', 'slide2');\n    feBlend.setAttribute('in2', 'SourceGraphic');\n    feBlend.setAttribute('mode', backgroundBlendMode);\n\n    const shapeBackground = svg.appendChild(document.createElementNS(namespaceURI, 'rect'));\n    shapeBackground.style.position = 'absolute';\n    shapeBackground.setAttribute('x', '0');\n    shapeBackground.setAttribute('y', '0');\n    shapeBackground.setAttribute('width', '100%');\n    shapeBackground.setAttribute('height', '100%');\n    shapeBackground.setAttribute('filter', `url(#${filterId})`);\n    shapeBackground.setAttribute('fill', backgroundColor);\n\n    return svg;\n  };\n\n  const applyFilter = () => {\n    const elements = document.querySelectorAll(`[data-background-blend-mode]`);\n\n    if (elements) {\n      elements.forEach(el => {\n        const { borderTopWidth, position, borderWidth, backgroundImage: backgroundImageUrl, backgroundColor } = getComputedStyle(el);\n        const backgroundImage = backgroundImageUrl && backgroundImageUrl.replace(/\"/g,'').slice(4, -1);\n        const backgroundBlendMode = el.dataset.backgroundBlendMode;\n\n        if (backgroundImage && backgroundColor && backgroundBlendMode) {\n          if (position === 'static') el.style.position = 'relative';\n\n          if (borderTopWidth) {\n            el.style.borderTopWidth = '0.01px';\n            el.style.borderTopColor = 'transparent';\n            el.style.borderTopStyle = 'solid';\n          }\n          const svg = createSVGFilter({ backgroundImage, backgroundColor, backgroundBlendMode });\n          el.prepend(svg);\n\n          // Если фон для Body, нужно по вешать обработчик события на измнения размеров окна\n          // потому что размер body может быть меньша размера документа, когда часть контента\n          // выпадает\n          if (el.tagName.toLowerCase() === 'body') {\n\t          let running = false;\n            let windowHeight = 0;\n\n            const update = () => {\n              if (windowHeight !== window.innerHeight) {\n                windowHeight = window.innerHeight;\n                svg.style.height = 'auto';\n                svg.style.height = `${document.documentElement.scrollHeight}px`;\n              }\n              running = false;\n            }\n\n            const requestTick = () => {\n              if(!running) requestAnimationFrame(update);\n              running = true;\n            }\n\n            window.addEventListener('resize', requestTick);\n          }\n        }\n      });\n    }\n  };\n\n  // if (isNotSupport)\n  window.addEventListener('load', applyFilter);\n})();\n"]}